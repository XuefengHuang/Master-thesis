\chapter{EVALUATION} 
\label{sec.evaluation}
In this section, we demonstrate \sysname's utility by implementing three use cases accessing different types of its API: comparing the performance of 2.4 GHz and 5 GHz bands, studying channel survey statistics, and performance in the home wireless environment. Our goal is to illustrate how \sysname can support a variety of measurement needs.
\section{Method}
\subsection{Measurements}
\label{ssec.measurements}

We perform both active and passive measurements of network traffic from a home wireless access point and correlate those measurements with the wireless metrics for the corresponding traffic. Passive measurements reflect the actual performance more accurately. Unlike passive measurement, active measurements generate additional network traffic to, for example, measure the time it takes for the packet to reach the other end of the network (TCP RTT) or the available capacity of a wireless network. However, active measurements might introduce contention or disturb the normal traffic flow. When active and passive measurements are combined, they are called hybrid measurement. 

To generate the maximum possible send/receive rate that \sysname can achieve, we use \texttt{socket.send}/\texttt{socket.recv} within a tight loop and using a timer to saturate the available network bandwidth. We perform all tests between clients on the same wireless network and home access point. We collect network traffic statistics and channel survey information from both wireless interfaces on the access point. The data collection on the access point is done by periodically querying some data exposed by our platform's supported API (e.g, \texttt{get\_network\_bytes} and \texttt{wifi\_status}). Our sandbox environment ensures that monitoring should not have any negative impact on the routers. To study TCP round-trip time between the wireless router and a wireless client, we implement a simple tool - tcping using our supported API (e.g., \texttt{openconnection}, \texttt{socketobject.send}, etc). 
 

\subsection{Metrics}
\label{ssec.metrics}

Our metrics are based on supported APIs provided by \sysname. We use channel busy time as an indicator of the channel utilization, and with channel transmit time and receive time, calculate the external interference. We also report the achieved throughput generated by the running experiments. We next elaborate on our metrics.

\textbf{Channel busy time:} The channel busy time is the amount of time the primary channel was sensed to be busy. This seems to be about the same as the sum of channel transmit and receive times, unless there is a lot of external interference (like another busy Wi-Fi network on the same channel)~\cite{channelsurvey}. We report the channel busy time every 30 seconds. Typically, a lower channel busy time is an indicator of good throughput and negligible interference.

\textbf{Channel transmit and receive time:} The channel transmit and receive time are the amount of time the radio spent transmitting and receiving data. In general, the relationship seems to be like that \cite{cfg80211}: 

\(\frac{t_{channel-tx} + t_{channel-rx}}{t_{channel}} < \frac{t_{channel-busy}}{t_{channel}} < 100\%\).

\textbf{Achieved throughput:} Our platform periodically (30 seconds) reports the actual throughput for each interfaces. Achieved throughput is the actual total number of bytes over time, and it captures the actual demand on the wireless network. This metric depends on the experiment's data rate and is bounded by the wireless effective throughput. The throughput is computed as the transmitted bytes over a one-second period.

\textbf{TCP round-trip time (RTT):} RTT is the difference between the time of the data and TCP SYN packets and its corresponding acknowledgements. As this RTT increases, it can have an adverse impact on performance, especially for applications that are latency sensitive. Measuring the RTT between the access point and the home devices is important for us to understand wireless performance.

\textbf{Additional metrics:} Our platform reports each station's \texttt{tx} retries and \texttt{tx} failed. \texttt{tx} retries and \texttt{tx} failed are reported only in downlink (gateway to station) and we use them as an additional performance indicator. Finally, our platform also reports Unix timestamp along with other metrics. This is used to calculate throughput and study network usage pattern. 

\section{Usecase: Comparing the wireless performance of 2.4 GHz and 5 GHz bands}
\label{sec.usecase1}

Better use of 5 GHz to improve wireless performance on a dense WiFi network is a common strategy because there are generally fewer devices in the 5 GHz band (and thus the noise floor is much lower), and it has less non-WiFi interference. Thus our hypothesis was that devices on the 5 GHz band would perform better.

We use \sysname to evaluate the wireless performance of network traffic on both 2.4 GHz and 5 GHz bands. Our focus is not on improving performance, but rather to underscore how we can use \sysname to gain useful insights into a real network.

For this experiment, the router that we use enables both 2.4 GHz and 5 GHz radios, which allows us to compare their performance. To ensure there is similar network traffic on both 2.4 GHz and 5 GHz band, we performed a multi-threaded TCP experiment on \sysname to send intermittent TCP packets to clients which connected to 2.4 GHz and 5 GHz band, respectively. Then we collect network traffic statistics to compare wireless network performance.

\begin{figure}
\begin{subfigure}{0.5\textwidth}
\includegraphics[width=\linewidth]{figure/throughput(5g_vs_2g).png}
\caption{Network traffic in the 5 GHz band achieve higher throughput} 
\label{fig:throughput}
\end{subfigure}
\hspace*{\fill} % separation between the subfigures
\begin{subfigure}{0.5\textwidth}
\includegraphics[width=\linewidth]{figure/channel_utilization(2g_vs_5g).png}
\caption{Network traffic in the 2.4 GHz band experience higher channel utilization.} 
\label{fig:utilization}
\end{subfigure}
\hspace*{\fill} % separation between the subfigures
\begin{subfigure}{0.45\textwidth}
\includegraphics[width=\linewidth]{figure/retries(2g_vs_5g).png}
\caption{Network traffic in the 2.4 GHz band experience higher retransmission.} 
\label{fig:retries}
\end{subfigure}
\hspace*{\fill} % separation between the subfigures
\begin{subfigure}{0.5\textwidth}
\includegraphics[width=\linewidth]{figure/external_interference(2g_vs_5g).png}
\caption{Network traffic in the 5 GHz band has less external interference.} 
\label{fig:interference}
\end{subfigure}
\caption{Characteristics of flows in the 5 GHz vs. 2.4 GHz spectrum.} 
\label{fig:5gvs2g}
\end{figure}

\textbf{2.4 GHz vs. 5 GHz:} To investigate the performance of 5 GHz and 2.4 GHz band, we use throughput, channel utilization, retransmission times and external interference as our indicator of wireless performance because we can obtain these metrics easily from our supported APIs. We calculate throughput as follows: using \texttt{get\_network\_bytes} to provide TCP statistics. We study the aggregate TCP throughput achieved during the captured lifetime of the network traffic. We compute the average throughput at every one-second interval by dividing aggregate TCP throughput and the difference between the correspond timestamp. \texttt{get\_station} can help us obtain the number of retry packets at each clients. We also compute channel utilization and external interference as the percentage of channel busy time and external interference time in any given one-second interval. 

We see that the use of 5 GHz improves performance, reducing channel utilization, external interference and retransmission rate. Figure \ref{fig:throughput} plots CDF of the throughput for all network traffic in wireless network, for both the 2.4 GHz band and the 5 GHz band. Only 20\% of 2.4 GHz network traffic see throughput above 0.4 Mbps; in contrast, more than 25\% of network traffic in the 5 GHz spectrum see throughput greater than 0.45 Mbps. Figure \ref{fig:utilization} shows the channel utilization for all network traffic in wireless network; the result shows that channel utilization in 2.4 GHz are much higher than 5 GHz, with about 95\% of network traffic having channel utilization above 20\%. Figure \ref{fig:retries} shows the retransmission times per second; the result shows that retransmissions are more common in the 2.4 GHz band, likely because the 5 GHz band is less crowded. Figure \ref{fig:interference} plots the CDF of the external interference for all network traffic for both the 2.4 GHz band and the 5 GHz bands. The 5 GHz band has less interference as it provides 23 non-overlapping channels. A limiting factor to identify the real wireless performance is the lack of contention and feedback from external sources (i.e., local contention and non-WiFi wireless devices). However, we still leverage channel busy time to detect channel utilization and external interference.

\begin{figure}
\centering
\includegraphics[width=0.8\textwidth]{figure/tcp_rtt.png}
\caption{LAN TCP round-trip time for different bands (e.g., 2 GHz, 5 GHz).} 
\label{fig:tcprtt}
\end{figure}

\textbf{TCP round-trip time is similar on 2.4 GHz and 5 GHz band.} We calculate TCP round-trip time by using the home router as vantage point and calculating the time between a TCP packet being sent and its respective TCP acknowledgement from a connected client. We collected the TCP round-trip time between the wireless home router and a wireless client on both 2.4 GHz and 5 GHz band 1000 times. Figure \ref{fig:tcprtt} plots the CDF of the TCP round-trip times for all network traffic for both the 2.4 GHz band and the 5 GHz band. Interestingly, the result shows that TCP round-trip time on 2.4 GHz and 5 GHz band are similar. To better understand our finding, we compute packet loss rate, which is measured as a percentage of packets lost with respect to packets sent. Packet loss rate on 2.4 GHz and 5 GHz band is 67.9\% and 75.7\%, respectively. This might be a reason to explain why there are different throughputs on each bands.  

\begin{figure}
\centering
\includegraphics[width=0.8\textwidth]{figure/bitrate(weekday_vs_weekend).png}
\caption{Bitrate on weekday and weekend in an office building on the NYU Brooklyn campus. Weekend bitrate is more than weekday bitrate.} 
\label{fig:compare}
\end{figure}  

\section{Usecase: Studying channel survey statistics}
\label{sec.usecase2}

\begin{figure}
\centering
\includegraphics[width=0.8\textwidth]{figure/channel.png}
\caption{Channel survey metrics in 2.4 GHz band through \texttt{wifi\_status}.} 
\label{fig:channelsurvey}
\end{figure}

The growing popularity of wireless networks leads to heavy utilization and congestion. Measurement studies show that congestion in a wireless network leads to lower overall network throughput and capability. Understanding the behavior of wireless networks is critical to ensure their robust operation and optimize network performance. To better understand congestion in wireless networks, \sysname provides the capabilities to explore radio channel channel utilization data. 

As~\cite{channelsurvey} did before, we replicated this experiment through our \sysname platform. We use \texttt{wifi\_status} to collect channel busy time, active time, transmit time and receive time for three hours. Figure \ref{fig:channelsurvey} shows the channel survey statistics captured in 2.4 GHz band. We find that channel active time is the same as running time if you don't change channels. Channel busy time seems to be the same as the sum of transmit time and receive time, unless there is a lot of external interference (e.g, heavy external traffic on the same channel, non-WiFi devices).

Next, we study the potential indicator, which can cause the degradation of a wireless performance. We investigate this by correlating the throughput (which can be caused by interference) with the channel utilization, external interference and signal strength. Interestingly, we find that there is no strong correlation between wireless performance and these metrics. Table \ref{table: Correlation} shows the correlation between these indicators available at the AP and the observed TCP throughput from our continuous network measurements. We observe that, lower airtime utilization does not necessarily result in higher TCP throughput. Note that we need to interpret our findings with caution. First, the TCP traffic do not saturate the wireless link. This is because our platform is deployed on resource-constrained devices. Therefore, we do not have fine-grained feedback of highest airtime utilization or external interference. Second, our platform does not capture all the activities in the home wireless network for a long time, which would allow us to gain deeper insights for the correlation between throughput and airtime utilization. Third, our platform does not report the traffic from nearby networks, which would allow us to gain deeper insights from the external interference.

\begin{table*}[]
\centering
\begin{tabular}{ |c|c| }
\hline
Indicator               & Correlation Coefficient  \\ 
\hline
Channel Utilization               &-0.0528  \\ 
\hline
External Interference & -0.0444 \\ 
\hline
Signal Strength & 0.0163 \\
\hline
\end{tabular}
\caption{Correlation of metrics with the observed TCP throughput.}
\label{table: Correlation}
\end{table*}

\section{Usecase: Studying home wireless environment}
\label{sec.usecase3}

\textbf{Within a home network, individual devices experience different wireless performance at different time.} Figure \ref{fig:compare} uses the WiFi data set to show throughput of the wireless network during a period of time of a day, partitioned into weekday and weekend. We observe a diurnal throughput on a home network in a office building at a period of time of a day on weekdays and weekends. We see that throughput is higher on the weekend than on weekday, which may result from less external interference (e.g., surrounding access points, clients).

\textbf{Home WiFi neighbourhood.} We next leverage the feedback from our platform, which is located in an office building, to analyse its WiFi neighbourhoods. Overall, we observe the number of neighbouring SSIDs around our wireless router varies between 26 and 64. The average number is around 46.45. We also observe network density at night (between 0:00 am and 6:00 am), and the average number is around 48.83. Therefore, the network density does not vary a lot between day and night (This possibly could due to employees work late or to lack of automation to manage these wireless routers).

\begin{figure}
\centering
\includegraphics[width=0.9\textwidth]{figure/2GHz_WiFi_channels.png}
\caption{Three channels that do not overlap in the on 2.4 GHz : 1, 6 and 11\cite{wlanchannels}.} 
\label{fig:channels}
\end{figure}

In the 2.4 GHz band, 1, 6 and 11 are the only non-overlapping channels. Selecting one or more of these channels is an important part of setting up your network correctly. As we can see from Figure \ref{fig:channels}, co-channel interference is where devices take turns talking, so the more devices on one channel, the longer it takes for a device to be heard since it must wait for its turn. In our dataset we find that access points in this building mostly use channel 1, 6, and 11. Specifically, 42\% of access points use channel 6, 21\% of access points use channel 1, 28\% of access points use channel 11 and the rest use other overlapping channels. In general, we expect equal network traffic in channel 1, 6, 11, respectively. However, since many wireless routers automatically select the channel for the user upon initial setup, it could lead to slow Wi-Fi speeds and interference. 

Overall, our results show that majority of access points (91\%) observed in an office building in NYU campus select non-overlapping channels. However, most of them are distributed on channel 6. This indicates that they might use static channel configurations and rarely get configured once they are deployed. Our study also found a behavioral pattern: most companies in the office building do not turn off routers after work time.   